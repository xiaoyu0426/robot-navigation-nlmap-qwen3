# NLMap + Qwen3 æœºå™¨äººå¯¼èˆªä¸ç‰©å“æè®®ç³»ç»Ÿ

**ä½œè€…**: è‚–å®‡æ°  
**å­¦æ ¡**: å—æ–¹ç§‘æŠ€å¤§å­¦  
**é‚®ç®±**: 12433332@mail.sustech.edu.cn  
**æ—¥æœŸ**: 2025å¹´6æœˆ5æ—¥  

æœ¬é¡¹ç›®å®ç°äº†åŸºäºè‡ªç„¶è¯­è¨€çš„æœºå™¨äººå¯¼èˆªç³»ç»Ÿï¼Œç»“åˆäº†NLMapçš„ç©ºé—´ç†è§£èƒ½åŠ›å’ŒQwen3å¤§è¯­è¨€æ¨¡å‹çš„ç‰©å“æè®®åŠŸèƒ½ï¼Œä¸ºæœºå™¨äººæä¾›æ™ºèƒ½çš„ä»»åŠ¡è§„åˆ’å’Œæ‰§è¡Œèƒ½åŠ›ã€‚

## ğŸš€ é¡¹ç›®ç‰¹æ€§

- **è‡ªç„¶è¯­è¨€ç†è§£**: æ”¯æŒä¸­è‹±æ–‡ä»»åŠ¡æè¿°è¾“å…¥
- **æ™ºèƒ½ç‰©å“æè®®**: åŸºäºQwen3-4Bæ¨¡å‹è¿›è¡Œç‰©å“æ¨ç†
- **ç©ºé—´è¯­ä¹‰æ˜ å°„**: åˆ©ç”¨NLMapè¿›è¡Œç¯å¢ƒç†è§£å’Œç‰©å“å®šä½
- **åˆ†é˜¶æ®µä»»åŠ¡è§„åˆ’**: è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–çš„æ‰§è¡Œè®¡åˆ’
- **ç¦»çº¿æ•°æ®æ”¯æŒ**: æ”¯æŒä»ç¦»çº¿æ•°æ®é›†æå–ç‰©å“æ¸…å•
- **äº¤äº’å¼ç•Œé¢**: æä¾›å‹å¥½çš„å‘½ä»¤è¡Œäº¤äº’ä½“éªŒ

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### ç¯å¢ƒä¿¡æ¯
- Python: 3.10+
- PyTorch: 2.5.1+cu121 (CUDAæ”¯æŒ)
- Transformers: 4.52.4
- è®¾å¤‡: CUDA (GPUåŠ é€Ÿæ¨è)

### ä¾èµ–å®‰è£…

```bash
# åˆ›å»ºcondaç¯å¢ƒ
conda create -n nlmap_qwen3_v2 python=3.10
conda activate nlmap_qwen3_v2

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install tensorflow  # ç”¨äºNLMap
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ nlmap_spot-main/                 # ä¸»è¦ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ offline_nlmap_qwen3_demo.py  # ç¦»çº¿æ¼”ç¤ºè„šæœ¬
â”‚   â”œâ”€â”€ saycan_qwen3.py              # Qwen3ç‰©å“æè®®å™¨
â”‚   â”œâ”€â”€ nlmap.py                     # NLMapæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ configs/                     # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ unline_data_config.ini   # ç¦»çº¿æ•°æ®é…ç½®
â”‚   â”œâ”€â”€ unline_data/                 # ç¦»çº¿æ•°æ®é›†
â”‚   â”‚   â””â”€â”€ cit121_115/              # ç¤ºä¾‹æ•°æ®
â”‚   â””â”€â”€ requirements.txt             # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ Qwen3-main/                      # Qwen3æ¨¡å‹æ–‡ä»¶
â”‚   â””â”€â”€ Qwen3-models/                # æ¨¡å‹æƒé‡
â””â”€â”€ README.md                        # é¡¹ç›®è¯´æ˜
```

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### 1. æ¨¡å‹å‡†å¤‡

ç¡®ä¿Qwen3-4Bæ¨¡å‹å·²ä¸‹è½½åˆ°æ­£ç¡®ä½ç½®ï¼š
```
Qwen3-main/Qwen3-models/
â”œâ”€â”€ config.json
â”œâ”€â”€ model-*.safetensors
â”œâ”€â”€ tokenizer.json
â””â”€â”€ ...
```

### 2. è¿è¡Œæ¼”ç¤º

```bash
cd nlmap_spot-main
python offline_nlmap_qwen3_demo.py
```

### 3. äº¤äº’ä½¿ç”¨

å¯åŠ¨åï¼Œæ‚¨å¯ä»¥ï¼š
- è¾“å…¥ä»»åŠ¡æè¿°ï¼ˆå¦‚ï¼š"æŠŠç¬”è®°æœ¬æ”¾åˆ°æ¡Œå­ä¸Šçš„æ¯å­æ—è¾¹"ï¼‰
- è¾“å…¥ `list` æŸ¥çœ‹å¯ç”¨ç‰©å“æ¸…å•
- è¾“å…¥ `quit` é€€å‡ºç³»ç»Ÿ

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ä»»åŠ¡ç¤ºä¾‹

```
ğŸ¤– è¯·è¾“å…¥ä»»åŠ¡æè¿°: åˆ¶ä½œä¸€æ¯å’–å•¡

ğŸ” å¤„ç†ä»»åŠ¡: åˆ¶ä½œä¸€æ¯å’–å•¡
----------------------------------------

1. Qwen3 ç‰©å“æè®®:
   æè®®çš„ç‰©å“: coffee machine, cup, coffee beans, water

2. åœ¨ç¦»çº¿æ•°æ®ä¸­æŸ¥æ‰¾åŒ¹é…:
   âœ“ æ‰¾åˆ° 4 ä¸ªåŒ¹é…ç‰©å“:
   â€¢ coffee machine: ä½ç½® (-1.21, -1.35, 0.36)
   â€¢ cup: ä½ç½® (0.29, 1.72, 1.07)
   â€¢ coffee beans: ä½ç½® (1.15, 0.83, 0.92)
   â€¢ water: ä½ç½® (-0.45, 2.11, 0.78)

3. åˆ†é˜¶æ®µè§„åˆ’:
   **é˜¶æ®µä¸€ï¼šè·å–æ‰€éœ€ç‰©å“**
   1. å‰å¾€å¨æˆ¿å°é¢ï¼Œæ‹¿å–å’–å•¡æœº
   2. å‰å¾€æ©±æŸœï¼Œå–å‡ºå’–å•¡æ¯
   3. å‰å¾€å‚¨ç‰©æŸœï¼Œè·å–å’–å•¡è±†
   4. å‰å¾€æ°´æ§½ï¼Œå‡†å¤‡æ¸…æ°´

   **é˜¶æ®µäºŒï¼šåˆ†æ­¥æ‰§è¡Œè§„åˆ’**
   1. å°†å’–å•¡æœºæ”¾ç½®åœ¨åˆé€‚çš„å·¥ä½œå°é¢ä¸Š
   2. æ£€æŸ¥å’–å•¡æœºç”µæºè¿æ¥
   3. åœ¨å’–å•¡æœºä¸­åŠ å…¥é€‚é‡æ¸…æ°´
   4. å°†å’–å•¡è±†æ”¾å…¥å’–å•¡æœºçš„è±†ä»“ä¸­
   5. å°†å’–å•¡æ¯æ”¾åœ¨å’–å•¡æœºå‡ºæ°´å£ä¸‹æ–¹
   6. å¯åŠ¨å’–å•¡æœºå¼€å§‹åˆ¶ä½œå’–å•¡

4. å¯æ‰§è¡Œçš„æ“ä½œ:
   â€¢ å¯¼èˆªåˆ° coffee machine: ç›®æ ‡ä½ç½® (-1.21, -1.35, 0.36)
   â€¢ æŠ“å– coffee machine: åœ¨å›¾åƒ color_20.jpg ä¸­æ£€æµ‹åˆ°
   â€¢ å¯¼èˆªåˆ° cup: ç›®æ ‡ä½ç½® (0.29, 1.72, 1.07)
   â€¢ æŠ“å– cup: åœ¨å›¾åƒ color_1.jpg ä¸­æ£€æµ‹åˆ°
```

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®é…ç½® (configs/unline_data_config.ini)

```ini
data = cit121_115

[paths]
data_dir_root = ./unline_data
pose_file = poses.txt
image_dir = color
```

### æ¨¡å‹è·¯å¾„é…ç½®

åœ¨ `saycan_qwen3.py` ä¸­ä¿®æ”¹æ¨¡å‹è·¯å¾„ï¼š
```python
model_path = "path/to/your/Qwen3-models"
```

## ğŸ“Š æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

1. **NLMap**: è´Ÿè´£ç©ºé—´è¯­ä¹‰ç†è§£å’Œç‰©å“å®šä½
2. **Qwen3-4B**: æä¾›è‡ªç„¶è¯­è¨€ç†è§£å’Œç‰©å“æ¨ç†
3. **æ•°æ®æå–å™¨**: ä»ç¦»çº¿æ•°æ®é›†æå–ç‰©å“æ¸…å•
4. **äº¤äº’ç•Œé¢**: å¤„ç†ç”¨æˆ·è¾“å…¥å’Œç»“æœå±•ç¤º

### å·¥ä½œæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥ä»»åŠ¡] --> B[Qwen3ç‰©å“æè®®]
    B --> C[ç¦»çº¿æ•°æ®åŒ¹é…]
    C --> D[ç”Ÿæˆåˆ†é˜¶æ®µè§„åˆ’]
    D --> E[è¾“å‡ºå¯æ‰§è¡Œæ“ä½œ]
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡å‹åŠ è½½å¤±è´¥**
   - æ£€æŸ¥Qwen3æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿æœ‰è¶³å¤Ÿçš„GPUå†…å­˜æˆ–åˆ‡æ¢åˆ°CPUæ¨¡å¼

2. **TensorFlowç›¸å…³é”™è¯¯**
   - å®‰è£…TensorFlow: `pip install tensorflow`
   - è®¾ç½®ç¯å¢ƒå˜é‡: `TF_ENABLE_ONEDNN_OPTS=0`

3. **æ•°æ®ç›®å½•ä¸å­˜åœ¨**
   - æ£€æŸ¥ `unline_data/cit121_115` ç›®å½•æ˜¯å¦å­˜åœ¨
   - ç¡®ä¿é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **GPUåŠ é€Ÿ**: ä½¿ç”¨CUDAåŠ é€ŸQwen3æ¨ç†
- **å†…å­˜ä¼˜åŒ–**: è®¾ç½® `low_cpu_mem_usage=True`
- **å¹¶è¡Œå¤„ç†**: é¿å…tokenizerå¹¶è¡Œå†²çª

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹ä¼˜ç§€çš„å¼€æºé¡¹ç›®æ„å»ºï¼š

### æ ¸å¿ƒä¾èµ–

- **[Qwen3](https://github.com/QwenLM/Qwen)**: é˜¿é‡Œäº‘å¼€å‘çš„å¤§è¯­è¨€æ¨¡å‹ï¼Œä¸ºæœ¬é¡¹ç›®æä¾›äº†å¼ºå¤§çš„è‡ªç„¶è¯­è¨€ç†è§£å’Œæ¨ç†èƒ½åŠ›
  - è®ºæ–‡: "Qwen Technical Report"
  - æ¨¡å‹: Qwen3-4B-Instruct
  - ç”¨é€”: ç‰©å“æè®®ã€ä»»åŠ¡è§„åˆ’ã€è‡ªç„¶è¯­è¨€å¤„ç†

- **[NLMap](https://github.com/HaochenZ11/nlmap-spot)**: è‡ªç„¶è¯­è¨€ç©ºé—´è¯­ä¹‰æ˜ å°„ç³»ç»Ÿ
  - è®ºæ–‡: "Natural Language Spatial Queries with Large Language Models"
  - ä½œè€…: Haochen Zhang et al.
  - ç”¨é€”: ç©ºé—´ç†è§£ã€ç‰©å“å®šä½ã€ç¯å¢ƒæ˜ å°„

### å‚è€ƒæ–‡çŒ®

```bibtex
@article{qwen3,
  title={Qwen Technical Report},
  author={Qwen Team},
  journal={arXiv preprint},
  year={2024}
}

@article{nlmap,
  title={Natural Language Spatial Queries with Large Language Models},
  author={Zhang, Haochen and others},
  journal={arXiv preprint},
  year={2024}
}
```

### ç‰¹åˆ«æ„Ÿè°¢

- Qwenå›¢é˜Ÿæä¾›çš„é«˜è´¨é‡å¼€æºå¤§è¯­è¨€æ¨¡å‹
- NLMapé¡¹ç›®å›¢é˜Ÿçš„ç©ºé—´è¯­ä¹‰æ˜ å°„æŠ€æœ¯
- æ‰€æœ‰ä¸ºå¼€æºç¤¾åŒºåšå‡ºè´¡çŒ®çš„å¼€å‘è€…ä»¬

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä»…ç”¨äºå­¦æœ¯ç ”ç©¶å’Œæ•™è‚²ç›®çš„ã€‚ä½¿ç”¨æ—¶è¯·éµå®ˆç›¸å…³æ¨¡å‹å’Œæ•°æ®é›†çš„è®¸å¯åè®®ã€‚